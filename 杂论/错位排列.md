错位排列的数学原理如下：
1. **错位排列的定义**：错位排列（Derangement）是指一种排列方式，其中没有元素出现在原来的位置上。例如，对于一个包含 ( n ) 个元素的集合，错位排列是指所有元素都不在原来的位置上的排列方式。

2. **递推公式的推导**：
   - 设 \( D (n) \) 表示 \( n \) 个元素的错位排列数。
   - 对于第 \( n \) 个元素，它不能在位置 \( n \) 上。因此，它可以选择 \( n-1 \) 个位置中的任意一个。
   - 如果第 \( n \) 个元素选定了位置 \( i \)（\( 1 \leq i \leq n-1 \)），那么有两种情况：
     - 第 \( i \) 个元素恰好选了位置 \( n \)。这种情况下，剩下的 \( n-2 \) 个元素需要错位排列，即 \( D (n-2) \)。
     - 第 \( i \) 个元素没有选位置 \( n \)。这种情况下，剩下的 \( n-1 \) 个元素需要错位排列，即 \( D (n-1) \)。
   - 因此，递推公式为 \( D (n) = (n-1) \times (D (n-1) + D (n-2)) \)。

3. **初始条件**：
   - \( D (0) = 1 \)：即没有元素时，有一种排列方式（空排列）。
   - \( D (1) = 0 \)：即一个元素时，无法错位排列。

4. **数学意义**：
   - 错位排列数 \( D (n) \) 是通过递推公式逐步计算得到的，其本质是利用了排列组合和递推的方法来解决元素不在原位的问题。

5. **优化和模运算**：
   - 由于 \( n \) 可能非常大，直接递推会导致数值溢出和计算时间过长的问题。因此，在每次计算中都引入模运算，确保数值在有效范围内，同时避免计算错误。

通过上述步骤，我们可以有效地计算出 \( n \) 个元素的错位排列数，并在每一步都进行模运算以满足问题的要求。