## 第一部分：双向连接边列表 (DCEL)

DCEL (Doubly Connected Edge List) 是一种用于表示平面图（如多边形地图、三维模型表面等）拓扑信息的高效数据结构。它不仅存储几何信息（点的位置），更重要的是存储了点、边、面之间的邻接关系。

### 1. 三大核心组件

DCEL 由三种类型的对象记录组成：

#### a. 顶点 (Vertex)

代表图中的一个点或角落。

- `coordinates`: 顶点的几何位置 (x, y)。
    
- `leaving_edge`: 一个指向从该顶点出发的**任意一条**半边的指针。
    

#### b. 面 (Face)

代表由边围成的一个区域。

- `outer_component`: 指向其外边界上的**任意一条**半边的指针。
    
- `inner_components`: 一个列表，包含指向其内部每个“洞”的边界上半边的指针（如果没有洞，则为空）。
    

#### c. 半边 (Half-Edge)

这是DCEL最核心、最巧妙的组件。**每一条逻辑上的边都被拆分为两条方向相反的、有向的半边**。

|   |   |
|---|---|
|**指针/属性**|**描述**|
|`origin`|指向这条半边的**起点**顶点。|
|`twin`|指向与它配对的、方向相反的另一条半边。|
|`next`|指向沿着其所属面的边界继续前进的下一条半边。|
|`incident_face`|指向这条半边**左侧**所邻接的面。|

### 2. 拓扑关系与遍历

DCEL的强大之处在于能通过指针轻松遍历图形。

- 遍历一个面的边界: 从一个面的 outer_component 指针开始，不断跟随 next 指针，即可不重不漏地走完整个边界，最终回到起点。
    
    e -> e.next -> e.next.next -> ...
    
- **找到一条边的另一个相邻面**: 从半边 `e` 出发，通过 `e.twin` 找到它的孪生兄弟，再查询 `e.twin.incident_face` 即可。
    
- 遍历一个顶点的所有出边: 这是最经典的遍历技巧。从顶点的 leaving_edge 指针 e 开始，通过 e.twin.next 组合可以按逆时针（或顺时针）顺序找到下一条出边。
    
    start_edge = v.leaving_edge
    
    current_edge = start_edge
    
    loop:
    
    // 处理 current_edge
    
    current_edge = current_edge.twin.next
    
    if current_edge == start_edge: break
    

## 第二部分：傅汝德算法 (Fortune's Algorithm)

这是一个经典的**扫描线算法**，用于高效地计算一组站点的**维诺图 (Voronoi Diagram)**。

### 1. 维诺图 (Voronoi Diagram)

给定平面上的一组站点，维诺图将平面划分为多个区域，每个区域都与一个站点对应。该区域内的任意一点都比到其他任何站点的距离更近。维诺图的边是相邻站点连线的垂直平分线。

### 2. 算法核心思想

#### a. 扫描线 (Sweep-Line)

一条假想的水平线，从上到下扫过整个平面。算法在任意时刻，都只处理扫描线上方的几何结构。

#### b. 海滩线 (Beach Line)

算法最核心的动态数据结构。它是一条由**多段抛物线弧**组成的复杂曲线。

- **定义**: 海滩线是所有“到某个已扫过站点的距离”与“到扫描线的距离”相等的点的集合。
    
- **构成**: 每一段抛物线弧都对应一个已扫过的站点（站点是焦点，扫描线是准线）。
    
- **作用**: 海滩线上**抛物线弧之间的交点**，在扫描线移动时的**轨迹**，就构成了最终维诺图的边。
    

### 3. 两种关键事件

算法由一个按Y坐标排序的事件队列驱动，只处理两种事件：

#### a. 站点事件 (Site Event)

- **发生时机**: 扫描线接触到一个新的站点 `p`。
    
- **处理过程**:
    
    1. 一条对应于 `p` 的新抛物线弧会“挤入”海滩线。
        
    2. 它会把正上方的一段老弧分裂成两段。
        
    3. 这个过程会**创建两个新的维诺图边的开端**。
        
    4. 需要检查新产生的邻接关系是否会在未来触发“圆事件”。
        

#### b. 圆事件 (Circle Event)

- **发生时机**: 海滩线上某段抛物线弧被其左右邻居彻底“挤扁”而消失。
    
- **几何意义**: 扫描线恰好接触到了一个同时穿过三个站点 `p, q, r` 的外接圆的最底端。
    
- **处理过程**:
    
    1. 被挤扁的弧在海滩线上消失。
        
    2. 其左右两个交点合并为一点，这个点就是一个**维诺图顶点**（即外接圆的圆心）。
        
    3. 在DCEL中记录下这个顶点，并完成相关边的连接。
        
    4. 需要检查因弧消失而产生的新邻接关系，看是否会触发新的“圆事件”。
        

算法通过不断处理这两种事件，动态地维护海滩线结构，并逐步构建出完整的维诺图（存储在DCEL中），直到事件队列为空。